{% extends 'base.html'%}
<h1>{%block title%} Projetos {%endblock%}</h1>

{%block content%}

<!-- 
<div class="spinner-wrapper">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div> -->


<!-- <script src="{{url_for('static',filename= 'js/plotly.min.js') }}"></script> -->


<div class="row">
    <h1>Dados</h1>
    <div class="col-md-8">
        <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item"><a href="{{url_for('index')}}">Dashboard</a></li>
            <li class="breadcrumb-item active">Dados</li>
        </ol>
    </div>
    <div class="col-md-4">
        <div class="card-body">
            <small>Consultar os Docentes na base do Lattes</small>
            <a href="https://buscatextual.cnpq.br/buscatextual/busca.do?metodo=apresentar" target="_blank">aqui</a>.
        </div>
    </div>
</div>
<div class="card mb-4">
    <h2>Docente</h2>
    <div class="row">
        <div class="col-md-8">
            <div class="card-header" id="card-header">
                <i class="fas fa-user me-1"></i>
                Docente
            </div>
            <br>
            <form method="get" id="forms">
                <select id="nome_docente" name="nome_docente" class="form-select form-select-sm mb-3">
                    <option value="" aria-required="true">DOCENTE </option>
                    {%for total in totalNotas%}
                    <option value="{{total[0]}}">{{total[0]}}<i class="fas fa-chart-simple me-1"></i> </option>
                    {%endfor%}

                </select>
            </form>
        </div>
        <!--
        <div class="col-md-4">
            <button type="button" id="mostrarGrafico" class="btn btn-secondary" onclick="mostrar('grafico')">Mostrar Grafico</button>
            <button type="button" id="mostrarTabela" class="btn btn-secondary" onclick="ocultar('tabelaQte')">Mostrar Tabela</button>
        </div>
        -->
        <div class="col-md-4">
            <div class="card-header" id="card-header">
                <i class="fas fa-chart-simple me-1"></i>
                Tipo de Visualização
            </div>
            <br>
            <select class="form-select form-select-sm mb-3" name="mostrar" id="mostrar"
                onchange="javascript:mostraAlerta(this);" style="display: none;">
                <option value="">Selecione uma Opção</option>
                <option value="tabelaQte">Mostrar Tabela</option>
                <option value="grafico">Mostrar Gráfico</option>
            </select>
        </div>
    </div>

    <input type="hidden" name="hidden_value" id="hidden_value">
    <div class="card-body">
        <div class="row">
            <div class="col-md-12" id="tabelaQte">
                <table class="table  table-striped table-bordered table-sm">

                    <tbody class="contadorEstratos">

                    </tbody>
                </table>
                <table class="table table-sm table-responsive">
                    <thead class="table table-dark" id="total">

                    </thead>
                </table>

            </div>
        </div>
        <div class="row">
            <div  id="chart" class="col-sm-8">
    
            </div>
    
            <div id="pizza" class="col-sm-4">
    
            </div>

        </div>


    </div>
</div>

<script>

    function ocultar(id) {
        var obj = document.getElementById('tabelaQte').hidden = false;
        var query = $('#hidden_value').val();
        load_data(query);
        var obj = $('#chart').empty();
    }

    function mostrar(id) {

        var query = $('#hidden_value').val();
        carrega_grafico(query)



        var objs = document.getElementById('tabelaQte').hidden = true;
    }

    function mostraAlerta(elemento) {
        var query = $('#hidden_value').val();
        if (elemento.value === 'tabelaQte') {
            ocultar(elemento);
        } else if (elemento.value === 'grafico') {

            mostrar(elemento);

        }
    }


    function carrega_grafico(query = '') {
        $.ajax({
            url: "/grafico",
            method: "POST",
            data: { query: query },

            success: function (data) {
                $('#chart').html(data);
                $('#chart').append(data.htmlresponse);
                $('#pizza').html(data);
                $('#pizza').append(data.htmlresponse);
            }
        });
    }

    function refreshDiv() {
        $('#chart').load(" #chart")
    }


    function load_data(query = '') {
        $.ajax({
            url: "/contadores",
            method: "POST",
            data: { query: query },

            success: function (data) {
                $('.contadorEstratos').html(data)
                $('.contadorEstratos').append(data.htmlresponse);
            }
        });
    }

    $('#nome_docente').change(function () {
        $('#hidden_value').val($('#nome_docente').val());
        var query = $('#hidden_value').val();
        $('#mostrar').show();
        $('#mostrar').val('');

    });



</script>
<style>
    #card-header {
        background-color: #3b3a3a;
        color: #fff;
        text-align: center;
    }

    #forms {
        padding: 0 5px 0 5px;
    }

    #mostrar {
        text-align: center;

    }
</style>
<script>

//    const spinnerWrapperEl = document.querySelector('.spinner-wrapper');
//    window.addEventListener('load',()=>{
//    spinnerWrapperEl.style.opacity = '0';
//    
//    setTimeout(()=>{
//        spinnerWrapperEl.style.display = 'none';
//    },200);
//
//});
</script>

{%endblock%}